<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Actor" rel="stylesheet" type="text/css">
<%= payment_method.inspect %>

<% Razorpay.setup(payment_method.preferences[:key_id], payment_method.preferences[:key_secret]) %>

<%= form_tag('/purchase', method: :post) do %>
  <script
     src="https://checkout.razorpay.com/v1/checkout.js"
     data-key="<%= payment_method.preferences[:key_id] %>"

     data-amount="<%= current_order.amount_in_paise %>"
     data-theme.color="#F37254"
    ></script>
<% end %>

<script>
$(document).ready(function(){
  var options = {
      "key": "<%= payment_method.preferences[:key_id] %>",
      "amount": "<%= current_order.amount_in_paise %>",
      "handler": function (response){
        var mapForm = document.createElement("form");
        mapForm.target = "_self";
        mapForm.method = "POST"; // or "post" if appropriate
        mapForm.action = "/purchase";

        var mapInput = document.createElement("input");
        mapInput.type = "text";
        mapInput.name = "payment_id";
        mapInput.value = response.razorpay_payment_id;
        mapForm.appendChild(mapInput);

        mapForm.submit();

      },
      "prefill": {
          "name": "<%= spree_current_user.try(:email) %>",
          "email": "<%= spree_current_user.try(:email) %>"
      },
      "notes": {
          "address": "Hello World"
      },
      "theme": {
          "color": "#198F69"
      }
  };
});
</script>
